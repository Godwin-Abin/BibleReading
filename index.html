<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Reading Plan Tracker</title>
    <!-- Favicon for all browsers -->
    <link rel="icon" type="image/x-icon" href="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">

    <!-- Optional: PNG version for modern browsers -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">
    <link rel="icon" type="image/png" sizes="16x16" href="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">

    <!-- Optional: Apple touch icon -->
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">

    <!-- Basic Meta -->
    <meta name="title" content="Bible Reading Plan Tracker">
    <meta name="description" content="Personal Bible Reading Plan Tracker only for personal use">

    <!-- Open Graph for Facebook & others -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://biblereading-007.web.app">
    <meta property="og:title" content="Bible Reading Plan Tracker">
    <meta property="og:description" content="Personal Bible Reading Plan Tracker only for personal use">
    <meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bible Reading Plan Tracker">
    <meta name="twitter:description" content="Personal Bible Reading Plan Tracker only for personal use">
    <meta name="twitter:image" content="https://firebasestorage.googleapis.com/v0/b/gabinroy.appspot.com/o/Bible%20Reading.png?alt=media&token=a6d12879-46c5-4747-ae99-81556d90acb4">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        const firebaseConfig = {
          apiKey: "AIzaSyAdDkjy875xQEInplbI7WjoSMi6p_MEB34",
          authDomain: "biblereading-007.firebaseapp.com",
          projectId: "biblereading-007",
          storageBucket: "biblereading-007.firebasestorage.app",
          messagingSenderId: "368099979471",
          appId: "1:368099979471:web:18e01098f7e22574c4c7ba",
          measurementId: "G-1KYPDB68KC"
        };

        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            createUserWithEmailAndPassword, // For email/password signup
            signInWithEmailAndPassword,     // For email/password login
            GoogleAuthProvider,             // For Google Sign-In
            signInWithPopup,                // For Google Sign-In popup
            signOut                         // For logging out
        } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // Global Firebase variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let analytics;
        let userId = null;
        let isAuthReady = false; // Initialize to false

        // Initialize Firebase services immediately
        // This block should only set up the Firebase app and its services.
        // Authentication state and UI updates should happen in DOMContentLoaded.
        try {
            app = initializeApp(firebaseConfig);
            analytics = getAnalytics(app);
            db = getFirestore(app);
            auth = getAuth(app);
            isAuthReady = true; // Set to true only if initialization is successful
        } catch (error) {
            console.error("Failed to initialize Firebase services:", error);
            // If Firebase initialization fails, isAuthReady remains false.
            // userId will be set to a random UUID in the DOMContentLoaded listener
            // if no authentication can be established.
        }

        // Set up authentication listener after DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            const userIdDisplay = document.getElementById('user-id-display');
            const authSection = document.getElementById('auth-section');
            const appContent = document.getElementById('app-content');
            const logoutButton = document.getElementById('logout-button');
            const userInfoDisplay = document.getElementById('user-info-display');

            if (!userIdDisplay || !authSection || !appContent || !logoutButton || !userInfoDisplay) {
                console.error("Critical UI elements not found. Cannot proceed with authentication logic.");
                return;
            }

            // Only proceed with auth state observation if Firebase services were initialized successfully
            if (isAuthReady) {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = `User ID: ${userId}`;
                        authSection.classList.add('hidden');
                        appContent.classList.remove('hidden');
                        logoutButton.classList.remove('hidden');

                        const userDisplayName = user.email || user.displayName || `User ${user.uid.substring(0, 8)}`;
                        userInfoDisplay.textContent = `Welcome, ${userDisplayName}!`;

                        await loadReadingPlan();
                    } else {
                        userId = null;
                        userIdDisplay.textContent = `User ID: Not logged in`;
                        authSection.classList.remove('hidden');
                        appContent.classList.add('hidden');
                        logoutButton.classList.add('hidden');
                        userInfoDisplay.textContent = '';
                        
                        fullPlanData = [];
                        renderFullPlan();
                        updateProgress();
                        updateTodaysReadingDisplay();

                        // Attempt initial sign-in if not already authenticated
                        if (auth && !auth.currentUser) { // Check if auth object exists and no user is currently signed in
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(auth, initialAuthToken);
                                } else {
                                    await signInAnonymously(auth);
                                }
                            } catch (error) {
                                console.error("Initial sign-in failed:", error);
                                userIdDisplay.textContent = `User ID: Unauthenticated (Error)`;
                            }
                        }
                    }
                });
            } else {
                // If Firebase initialization failed, display an error and keep auth section visible
                userIdDisplay.textContent = `User ID: Firebase Init Failed`;
                authSection.classList.remove('hidden');
                appContent.classList.add('hidden');
                document.getElementById('auth-error-message').textContent = "Firebase initialization failed. Please check your configuration.";
            }
        });

        const bibleBookChapters = {
            "Exodus": 40, "Leviticus": 27, "Numbers": 36, "Deuteronomy": 34,
            "Joshua": 24, "Judges": 21, "Ruth": 4, "1 Samuel": 31, "2 Samuel": 24,
            "1 Kings": 22, "2 Kings": 25, "1 Chronicles": 29, "2 Chronicles": 36, "Ezra": 10,
            "Nehemiah": 13, "Esther": 10, "Job": 42, "Psalms": 150, "Proverbs": 31,
            "Ecclesiastes": 12, "Song of Solomon": 8, "Isaiah": 66, "Jeremiah": 52,
            "Lamentations": 5, "Ezekiel": 48, "Daniel": 12, "Hosea": 14, "Joel": 3, "Amos": 9,
            "Obadiah": 1, "Jonah": 4, "Micah": 7, "Nahum": 3, "Habakkuk": 3, "Zephaniah": 3,
            "Haggai": 2, "Zechariah": 14, "Malachi": 4,
            "Matthew": 28, "Mark": 16, "Luke": 24, "John": 21, "Acts": 28, "Romans": 16,
            "1 Corinthians": 16, "2 Corinthians": 13, "Galatians": 6, "Ephesians": 6,
            "Philippians": 4, "Colossians": 4, "1 Thessalonians": 5, "2 Thessalonians": 3,
            "1 Timothy": 6, "2 Timothy": 4, "Titus": 3, "Philemon": 1, "Hebrews": 13,
            "James": 5, "1 Peter": 5, "2 Peter": 3, "1 John": 5, "2 John": 1, "3 John": 1,
            "Jude": 1, "Revelation": 22
        };

        const sourcePlanMonthlySummary = [
            { monthName: "May 2025", startDay: 24, daysInMonth: 31, part: "Old Testament", readings: [{ book: "Exodus", startChapter: 4, endChapter: 35, totalChapters: 32 }] },
            { monthName: "June 2025", startDay: 1, daysInMonth: 30, part: "Old Testament", readings: [{ book: "Exodus", startChapter: 36, endBook: "Joshua", endChapter: 18, totalChapters: 120 }] },
            { monthName: "July 2025", startDay: 1, daysInMonth: 31, part: "Old Testament", readings: [{ book: "Joshua", startChapter: 19, endBook: "2 Kings", endChapter: 16, totalChapters: 124 }] },
            { monthName: "August 2025", startDay: 1, daysInMonth: 31, part: "Old Testament", readings: [{ book: "2 Kings", startChapter: 17, endBook: "Job", endChapter: 17, totalChapters: 124 }] },
            { monthName: "September 2025", startDay: 1, daysInMonth: 30, part: "Old Testament", readings: [{ book: "Job", startChapter: 18, endBook: "Psalms", endChapter: 95, totalChapters: 120 }] },
            { monthName: "October 2025", startDay: 1, daysInMonth: 31, part: "Old Testament", readings: [{ book: "Psalms", startChapter: 96, endBook: "Isaiah", endChapter: 18, totalChapters: 124 }] },
            { monthName: "November 2025", startDay: 1, daysInMonth: 30, part: "Old Testament", readings: [{ book: "Isaiah", startChapter: 19, endBook: "Ezekiel", endChapter: 15, totalChapters: 120 }] },
            { monthName: "December 2025", startDay: 1, daysInMonth: 31, part: "Old Testament & New Testament", readings: [
                { book: "Ezekiel", startChapter: 16, endBook: "Malachi", endChapter: 4, totalChapters: 112 },
                { book: "Matthew", startChapter: 1, endChapter: 12, totalChapters: 12 }
            ]},
            { monthName: "January 2026", startDay: 1, daysInMonth: 31, part: "New Testament", readings: [
                { book: "Matthew", startChapter: 13, endBook: "John", endChapter: 21, totalChapters: 77 },
                { book: "Acts", startChapter: 1, endChapter: 28, totalChapters: 28 },
                { book: "Romans", startChapter: 1, endChapter: 16, totalChapters: 16 },
                { book: "1 Corinthians", startChapter: 1, endChapter: 3, totalChapters: 3 }
            ]},
            { monthName: "February 2026", startDay: 1, daysInMonth: 28, part: "New Testament", readings: [
                { book: "1 Corinthians", startChapter: 4, endBook: "2 Corinthians", endChapter: 13, totalChapters: 26 },
                { book: "Galatians", startChapter: 1, endBook: "Philemon", endChapter: 1, totalChapters: 42 },
                { book: "Hebrews", startChapter: 1, endBook: "Jude", endChapter: 1, totalChapters: 34 },
                { book: "Revelation", startChapter: 1, endChapter: 10, totalChapters: 10 }
            ]},
            { monthName: "March 2026", startDay: 1, daysInMonth: 31, part: "New Testament", readings: [{ book: "Revelation", startChapter: 11, endChapter: 21, totalChapters: 11 }] }
        ];

        let fullPlanData = [];
        let progressChartInstance = null;
        const CHAPTERS_PER_DAY = 4;
        const PLAN_DOC_ID = 'myReadingPlan';

        function getBookOrder() {
            return Object.keys(bibleBookChapters);
        }
        
        async function loadReadingPlan() {
            if (!isAuthReady || !db || !userId) {
                console.log("Authentication not ready or DB/userId not available yet. Skipping plan load.");
                return;
            }

            const planDocRef = doc(db, `artifacts/${appId}/users/${userId}/readingPlans`, PLAN_DOC_ID);

            onSnapshot(planDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    console.log("Loading plan from Firestore.");
                    fullPlanData = JSON.parse(docSnap.data().planData);
                } else {
                    console.log("No plan found in Firestore, generating new plan.");
                    generateFullPlanData();
                    saveReadingPlan();
                }
                renderFullPlan();
                updateProgress();
                updateTodaysReadingDisplay();
            }, (error) => {
                console.error("Error fetching document:", error);
                console.log("Error fetching plan, generating new plan locally.");
                generateFullPlanData();
                renderFullPlan();
                updateProgress();
                updateTodaysReadingDisplay();
            });
        }

        function generateFullPlanData() {
            const bookOrder = getBookOrder();
            let overallReadingIdCounter = 0;
            let currentBookIndex = bookOrder.indexOf("Exodus");
            let currentBookName = bookOrder[currentBookIndex];
            let currentChapterNum = 4;

            fullPlanData = [];

            sourcePlanMonthlySummary.forEach(monthData => {
                const year = parseInt(monthData.monthName.split(" ")[1]);
                const monthJs = new Date(Date.parse(monthData.monthName +" 1, 2000")).getMonth();
                let daysInThisMonth = (monthData.monthName === "May 2025") ? (monthData.daysInMonth - monthData.startDay + 1) : 
                                     (monthData.monthName === "March 2026") ? Math.ceil(monthData.readings.reduce((sum, r) => sum + r.totalChapters, 0) / CHAPTERS_PER_DAY) 
                                     : new Date(year, monthJs + 1, 0).getDate();
                
                if (monthData.monthName === "February 2026") daysInThisMonth = 28;

                const monthEntry = {
                    month: monthData.monthName,
                    part: monthData.part,
                    dailyReadings: [],
                    totalMonthChapters: 0
                };

                for (let day = 0; day < daysInThisMonth; day++) {
                    let dayChapters = [];
                    let dayReadingDisplayString = "";
                    let chaptersForThisDay = 0;

                    for (let i = 0; i < CHAPTERS_PER_DAY; i++) {
                        if (currentBookName && currentChapterNum > bibleBookChapters[currentBookName]) {
                            currentBookIndex++;
                            if (currentBookIndex < bookOrder.length) {
                                currentBookName = bookOrder[currentBookIndex];
                                currentChapterNum = 1;
                            } else {
                                currentBookName = null;
                                currentChapterNum = null;
                                break;
                            }
                        }
                        
                        if (currentBookName === null) break;

                        dayChapters.push({
                            id: `chapter-${overallReadingIdCounter++}`,
                            book: currentBookName,
                            chapterNum: currentChapterNum,
                            completed: false
                        });
                        chaptersForThisDay++;
                        currentChapterNum++;
                    }

                    if (dayChapters.length > 0) {
                        let currentSegmentBook = dayChapters[0].book;
                        let currentSegmentStartChapter = dayChapters[0].chapterNum;
                        let currentSegmentEndChapter = dayChapters[0].chapterNum;
                        let segments = [];

                        for (let k = 1; k < dayChapters.length; k++) {
                            const chapter = dayChapters[k];
                            if (chapter.book === currentSegmentBook && chapter.chapterNum === currentSegmentEndChapter + 1) {
                                currentSegmentEndChapter = chapter.chapterNum;
                            } else {
                                segments.push(`${currentSegmentBook} ${currentSegmentStartChapter}${currentSegmentStartChapter !== currentSegmentEndChapter ? `-${currentSegmentEndChapter}` : ''}`);
                                currentSegmentBook = chapter.book;
                                currentSegmentStartChapter = chapter.chapterNum;
                                currentSegmentEndChapter = chapter.chapterNum;
                            }
                        }
                        segments.push(`${currentSegmentBook} ${currentSegmentStartChapter}${currentSegmentStartChapter !== currentSegmentEndChapter ? `-${currentSegmentEndChapter}` : ''}`);
                        dayReadingDisplayString = segments.join(', ');
                    } else {
                        dayReadingDisplayString = "No reading scheduled";
                    }
                    
                    const date = new Date(year, monthJs, (monthData.monthName === "May 2025") ? monthData.startDay + day : day + 1);
                    
                    monthEntry.dailyReadings.push({
                        date: date.toISOString().split('T')[0],
                        booksAndChaptersDisplay: dayReadingDisplayString,
                        chapters: dayChapters
                    });
                    monthEntry.totalMonthChapters += chaptersForThisDay;
                }
                fullPlanData.push(monthEntry);
            });
        }


        function renderFullPlan() {
            const accordionContainer = document.getElementById('plan-accordion');
            accordionContainer.innerHTML = ''; 

            fullPlanData.forEach((monthPlan, monthIndex) => {
                const monthDiv = document.createElement('div');
                monthDiv.className = 'bg-white rounded-lg shadow';

                const button = document.createElement('button');
                button.className = 'w-full flex justify-between items-center p-4 text-left text-lg font-semibold text-sky-700 hover:bg-sky-50 rounded-t-lg focus:outline-none';
                button.innerHTML = `
                    <span>${monthPlan.month} (${monthPlan.part}) - ${monthPlan.totalMonthChapters} Chapters</span>
                    <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                `;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'p-4 border-t border-slate-200 hidden space-y-3';
                contentDiv.id = `month-content-${monthIndex}`;

                monthPlan.dailyReadings.forEach((dayReading, dayIndex) => {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'p-2 bg-slate-50 rounded hover:bg-slate-100';
                    
                    const dateObj = new Date(dayReading.date + 'T00:00:00');
                    const formattedDate = `${dateObj.toLocaleString('default', { month: 'short' })} ${dateObj.getDate()}`;

                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'font-medium text-slate-700 mb-2';
                    dayHeader.textContent = `${formattedDate}: ${dayReading.booksAndChaptersDisplay}`;
                    dayDiv.appendChild(dayHeader);

                    const chaptersContainer = document.createElement('div');
                    chaptersContainer.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 pl-4';

                    dayReading.chapters.forEach(chapter => {
                        const chapterItem = document.createElement('div');
                        chapterItem.className = 'flex items-center';
                        
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = chapter.id;
                        checkbox.checked = chapter.completed;
                        checkbox.className = 'form-checkbox h-4 w-4 text-amber-500 rounded border-slate-300 focus:ring-amber-400 mr-2';
                        checkbox.addEventListener('change', () => {
                            chapter.completed = checkbox.checked;
                            saveReadingPlan();
                        });

                        const label = document.createElement('label');
                        label.htmlFor = chapter.id;
                        label.className = 'text-sm text-slate-800 cursor-pointer';
                        label.textContent = `${chapter.book} ${chapter.chapterNum}`;

                        chapterItem.appendChild(checkbox);
                        chapterItem.appendChild(label);
                        chaptersContainer.appendChild(chapterItem);
                    });
                    dayDiv.appendChild(chaptersContainer);
                    contentDiv.appendChild(dayDiv);
                });

                button.addEventListener('click', () => {
                    contentDiv.classList.toggle('hidden');
                    button.querySelector('svg').classList.toggle('rotate-180');
                });
                
                monthDiv.appendChild(button);
                monthDiv.appendChild(contentDiv);
                accordionContainer.appendChild(monthDiv);
            });
        }

        function updateProgress() {
            let chaptersReadCount = 0;
            let totalPlanChapters = 0;

            fullPlanData.forEach(monthPlan => {
                monthPlan.dailyReadings.forEach(dayReading => {
                    dayReading.chapters.forEach(chapter => {
                        totalPlanChapters++;
                        if (chapter.completed) {
                            chaptersReadCount++;
                        }
                    });
                });
            });
            
            document.getElementById('chaptersRead').textContent = chaptersReadCount;
            document.getElementById('totalChapters').textContent = totalPlanChapters;
            
            const percentage = totalPlanChapters > 0 ? Math.round((chaptersReadCount / totalPlanChapters) * 100) : 0;
            document.getElementById('percentageComplete').textContent = percentage;

            if (progressChartInstance) {
                progressChartInstance.data.datasets[0].data = [chaptersReadCount, totalPlanChapters - chaptersReadCount];
                progressChartInstance.update();
            }
            updateTodaysReadingDisplay();
        }

        function renderDashboardChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            if (progressChartInstance) {
                progressChartInstance.destroy();
            }
            progressChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Read', 'Remaining'],
                    datasets: [{
                        data: [0, 1],
                        backgroundColor: ['#38BDF8', '#E2E8F0'],
                        borderColor: ['#FFFFFF', '#FFFFFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            });
        }
        
        function updateTodaysReadingDisplay() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('currentDateDisplay').textContent = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            let foundToday = false;
            let todaysReadingText = "No reading scheduled for today.";
            let todaysReadingStatusText = "";
            let completedTodayCount = 0;
            let totalTodayCount = 0;

            for (const monthPlan of fullPlanData) {
                for (const dayReading of monthPlan.dailyReadings) {
                    if (dayReading.date === todayString) {
                        todaysReadingText = dayReading.booksAndChaptersDisplay;
                        totalTodayCount = dayReading.chapters.length;
                        completedTodayCount = dayReading.chapters.filter(c => c.completed).length;

                        if (totalTodayCount > 0) {
                            todaysReadingStatusText = `${completedTodayCount} of ${totalTodayCount} chapters completed today.`;
                            if (completedTodayCount === totalTodayCount) {
                                todaysReadingStatusText += " Great job!";
                                document.getElementById('todaysReadingStatus').className = "text-xs text-green-600";
                            } else {
                                todaysReadingStatusText += " Keep going!";
                                document.getElementById('todaysReadingStatus').className = "text-xs text-red-600";
                            }
                        } else {
                            todaysReadingStatusText = "No chapters assigned for today.";
                            document.getElementById('todaysReadingStatus').className = "text-xs";
                        }
                        foundToday = true;
                        break;
                    }
                }
                if (foundToday) break;
            }
            document.getElementById('todaysReading').textContent = todaysReadingText;
            document.getElementById('todaysReadingStatus').textContent = todaysReadingStatusText;
            if (!foundToday) {
                document.getElementById('todaysReadingStatus').className = "text-xs";
            }
        }

        async function saveReadingPlan() {
            if (!isAuthReady || !db || !userId) {
                console.log("Cannot save: Authentication not ready or DB/userId not available.");
                return;
            }
            try {
                const planDocRef = doc(db, `artifacts/${appId}/users/${userId}/readingPlans`, PLAN_DOC_ID);
                await setDoc(planDocRef, {
                    planData: JSON.stringify(fullPlanData),
                    userId: userId,
                    lastUpdated: new Date().toISOString()
                });
                console.log("Reading plan saved to Firestore!");
                updateProgress();
            } catch (error) {
                console.error("Error saving reading plan to Firestore:", error);
            }
        }

        function handleNavigation() {
            const tabs = document.querySelectorAll('.tab-button');
            const sections = {
                dashboard: document.getElementById('dashboard-section'),
                'full-plan': document.getElementById('full-plan-section'),
                tips: document.getElementById('tips-section')
            };

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const activeTab = tab.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    Object.values(sections).forEach(section => {
                        section.classList.add('hidden');
                        section.classList.remove('section-fade-enter-active');
                    });
                    
                    sections[activeTab].classList.remove('hidden');
                    void sections[activeTab].offsetWidth; 
                    sections[activeTab].classList.add('section-fade-enter-active');
                });
            });
        }

        async function handleSignUp() {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            document.getElementById('auth-error-message').textContent = "";
            if (!isAuthReady || !auth) {
                document.getElementById('auth-error-message').textContent = "Firebase not ready. Please wait.";
                return;
            }
            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                document.getElementById('auth-error-message').textContent = `Signup Error: ${error.message}`;
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            document.getElementById('auth-error-message').textContent = "";
            if (!isAuthReady || !auth) {
                document.getElementById('auth-error-message').textContent = "Firebase not ready. Please wait.";
                return;
            }
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                document.getElementById('auth-error-message').textContent = `Login Error: ${error.message}`;
            }
        }

        async function handleGoogleSignIn() {
            document.getElementById('auth-error-message').textContent = "";
            if (!isAuthReady || !auth) {
                document.getElementById('auth-error-message').textContent = "Firebase not ready. Please wait.";
                return;
            }
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                document.getElementById('auth-error-message').textContent = `Google Sign-In Error: ${error.message}`;
            }
        }

        async function handleLogout() {
            if (!isAuthReady || !auth) {
                console.warn("Firebase not ready for logout.");
                return;
            }
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Logout Error:", error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            renderDashboardChart();
            handleNavigation();

            document.getElementById('signup-button').addEventListener('click', handleSignUp);
            document.getElementById('login-button').addEventListener('click', handleLogin);
            document.getElementById('google-signin-button').addEventListener('click', handleGoogleSignIn);
            document.getElementById('logout-button').addEventListener('click', handleLogout);

            document.getElementById('app-content').classList.add('hidden');
            document.getElementById('auth-section').classList.remove('hidden');
        });

    </script>
</head>
<body class="bg-slate-50 text-slate-700 font-sans">
    <div id="app" class="container mx-auto p-4 max-w-5xl">
        <header class="bg-sky-600 text-white p-6 rounded-lg shadow-md mb-8">
            <h1 class="text-3xl font-bold text-center">Bible Reading Plan Tracker</h1>
            <p class="text-center text-sky-100 mt-1">Exodus 4 to Revelation 21 (by March 31, 2026)</p>
            <div id="user-info-display" class="text-center text-sky-100 text-base mt-2"></div>
            <div id="user-id-display" class="text-center text-sky-200 text-sm mt-1 break-all">Loading User ID...</div>
            <button id="logout-button" class="hidden mt-4 mx-auto block bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-colors duration-200">Logout</button>
        </header>

        <section id="auth-section" class="p-2 sm:p-4 hidden">
            <div class="bg-white p-6 rounded-lg shadow-md max-w-md mx-auto">
                <h2 class="text-2xl font-semibold text-sky-700 mb-4 text-center">Sign Up or Log In</h2>
                <p class="text-slate-600 mb-4 text-center">Log in to save your reading progress and track your journey!</p>
                
                <div id="auth-error-message" class="text-red-600 text-center mb-4"></div>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold text-sky-700 mb-3">Email & Password</h3>
                    <input type="email" id="signup-email" placeholder="Email for Signup" class="w-full p-3 mb-2 border border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500">
                    <input type="password" id="signup-password" placeholder="Password for Signup" class="w-full p-3 mb-4 border border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500">
                    <button id="signup-button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">Sign Up</button>
                </div>

                <div class="mb-6">
                    <input type="email" id="login-email" placeholder="Email for Login" class="w-full p-3 mb-2 border border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500">
                    <input type="password" id="login-password" placeholder="Password for Login" class="w-full p-3 mb-4 border border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500">
                    <button id="login-button" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200">Log In</button>
                </div>

                <div class="relative flex py-5 items-center">
                    <div class="flex-grow border-t border-slate-300"></div>
                    <span class="flex-shrink mx-4 text-slate-500">OR</span>
                    <div class="flex-grow border-t border-slate-300"></div>
                </div>

                <button id="google-signin-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md flex items-center justify-center space-x-2 transition-colors duration-200">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.24 10.27c-.23-.74-.86-1.31-1.61-1.61-.75-.3-1.6-.47-2.48-.47-2.92 0-5.3 2.38-5.3 5.3s2.38 5.3 5.3 5.3c2.31 0 4.25-1.48 4.96-3.56l.04-.15h-4.96v-3.56h8.4c.09.5.14 1.02.14 1.57 0 5.17-3.98 9.38-9.38 9.38-5.17 0-9.38-4.21-9.38-9.38s4.21-9.38 9.38-9.38c2.6 0 4.9.98 6.7 2.59l-2.8 2.8c-1.18-.88-2.65-1.4-4.2-1.4z" fill="#4285F4"/><path d="M12.24 10.27c-.23-.74-.86-1.31-1.61-1.61-.75-.3-1.6-.47-2.48-.47-2.92 0-5.3 2.38-5.3 5.3s2.38 5.3 5.3 5.3c2.31 0 4.25-1.48 4.96-3.56l.04-.15h-4.96v-3.56h8.4c.09.5.14 1.02.14 1.57 0 5.17-3.98 9.38-9.38 9.38-5.17 0-9.38-4.21-9.38-9.38s4.21-9.38 9.38-9.38c2.6 0 4.9.98 6.7 2.59l-2.8 2.8c-1.18-.88-2.65-1.4-4.2-1.4z" fill="#FBBC05"/><path d="M21.56 12.24c0-.55-.05-1.07-.14-1.57l-.04.15h-8.4v3.56h4.96c-.71 2.08-2.65 3.56-4.96 3.56-2.92 0-5.3-2.38-5.3-5.3s2.38-5.3 5.3-5.3c1.55 0 3.02.52 4.2 1.4l2.8-2.8c-1.8-1.61-4.1-2.59-6.7-2.59-5.17 0-9.38 4.21-9.38 9.38s4.21 9.38 9.38 9.38c5.4 0 9.38-4.21 9.38-9.38z" fill="#EA4335"/><path d="M21.56 12.24c0-.55-.05-1.07-.14-1.57l-.04.15h-8.4v3.56h4.96c-.71 2.08-2.65 3.56-4.96 3.56-2.92 0-5.3-2.38-5.3-5.3s2.38-5.3 5.3-5.3c1.55 0 3.02.52 4.2 1.4l2.8-2.8c-1.8-1.61-4.1-2.59-6.7-2.59-5.17 0-9.38 4.21-9.38 9.38s4.21 9.38 9.38 9.38c5.4 0 9.38-4.21 9.38-9.38z" fill="#34A853"/></svg>
                    <span>Sign in with Google</span>
                </button>
            </div>
        </section>

        <div id="app-content" class="hidden">
            <nav class="mb-8 flex justify-center space-x-2 sm:space-x-4 border-b border-slate-300 pb-2">
                <button data-tab="dashboard" class="tab-button px-3 py-2 sm:px-4 sm:py-3 text-sm sm:text-base text-slate-600 hover:text-sky-600 transition-colors duration-200 active">Dashboard</button>
                <button data-tab="full-plan" class="tab-button px-3 py-2 sm:px-4 sm:py-3 text-sm sm:text-base text-slate-600 hover:text-sky-600 transition-colors duration-200">Full Plan</button>
                <button data-tab="tips" class="tab-button px-3 py-2 sm:px-4 sm:py-3 text-sm sm:text-base text-slate-600 hover:text-sky-600 transition-colors duration-200">Tips</button>
            </nav>

            <main id="main-content">
                <section id="dashboard-section" class="p-2 sm:p-4 section-fade-enter-active">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h2 class="text-2xl font-semibold text-sky-700 mb-1">Welcome to Your Reading Journey!</h2>
                        <p class="text-slate-600 mb-4">This dashboard provides an overview of your progress through the Bible reading plan. Track your completed chapters, see what's next, and stay motivated!</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold text-sky-700 mb-3">Overall Progress</h3>
                            <div class="chart-container mb-4">
                                <canvas id="progressChart"></canvas>
                            </div>
                            <div class="text-center">
                                <p class="text-lg"><span id="chaptersRead" class="font-bold text-sky-600">0</span> / <span id="totalChapters" class="font-bold">0</span> Chapters Read</p>
                                <p class="text-2xl font-bold text-amber-500"><span id="percentageComplete">0</span>% Complete</p>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md flex flex-col justify-between">
                            <div>
                                <h3 class="text-xl font-semibold text-sky-700 mb-3">Plan Details</h3>
                                <ul class="space-y-2 text-slate-600">
                                    <li><strong>Goal:</strong> Complete by March 31, 2026</li>
                                    <li><strong>Start Date:</strong> May 24, 2025</li>
                                    <li><strong>Daily Target:</strong> Approx. 4 Chapters</li>
                                    <li class="mt-3 pt-3 border-t border-slate-200">
                                        <h4 class="text-lg font-semibold text-sky-700 mb-1">Today's Reading (<span id="currentDateDisplay"></span>):</h4>
                                        <p id="todaysReading" class="text-amber-600 font-medium">Loading...</p>
                                        <p id="todaysReadingStatus" class="text-xs"></p>
                                    </li>
                                </ul>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm text-slate-500">Keep up the great work! Every chapter read brings you closer to your goal.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="full-plan-section" class="p-2 sm:p-4 hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h2 class="text-2xl font-semibold text-sky-700 mb-1">Detailed Reading Plan</h2>
                        <p class="text-slate-600 mb-4">Here is the full breakdown of your reading plan, month by month. Check off each day's reading as you complete it. Your progress will be updated on the Dashboard.</p>
                    </div>
                    <div id="plan-accordion" class="space-y-4">
                        </div>
                </section>

                <section id="tips-section" class="p-2 sm:p-4 hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-semibold text-sky-700 mb-1">Tips for Success</h2>
                        <p class="text-slate-600 mb-4">Follow these tips to help you stay consistent and get the most out of your Bible reading journey.</p>
                        <ul class="list-disc list-inside space-y-3 text-slate-600 pl-2">
                            <li><strong>Consistency is Key:</strong> Aim to read at the same time each day to build a strong habit.</li>
                            <li><strong>Flexibility:</strong> If you miss a day, don't get discouraged! Simply pick up where you left off or add a few extra chapters on subsequent days to catch up.</li>
                            <li><strong>Understand, Don't Just Read:</strong> Take time to reflect on what you're reading. Consider using a study Bible or commentary if you want to delve deeper into the text.</li>
                            <li><strong>Pray:</strong> Before you start reading, ask for understanding and wisdom.</li>
                            <li><strong>Listen:</strong> If reading is difficult or you're on the go, consider listening to an audio Bible.</li>
                            <li><strong>Adjust as Needed:</strong> This is a guideline. Feel free to adjust the daily chapter count slightly to fit your personal schedule and reading speed. Some days you might feel like reading more, and that's perfectly fine!</li>
                        </ul>
                    </div>
                </section>
            </main>
        </div>

        <footer class="text-center mt-12 mb-6 text-sm text-slate-500">
            <p>&copy; <span id="currentYear"></span> Bible Reading Plan Tracker. Happy Reading!</p>
        </footer>
    </div>

</body>
</html>
